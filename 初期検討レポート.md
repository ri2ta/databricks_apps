# ğŸ“˜ Databricks Apps ã§å‹•ã‹ã™  
# **ãƒ¢ãƒ‡ãƒ«é§†å‹•ã‚¢ãƒ—ãƒªçš„ãƒ»æ±ç”¨ CRUD ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯æ§‹æƒ³ãƒ¬ãƒãƒ¼ãƒˆ**  
ï¼ˆFlask + htmx + Alpine.js + Tailwindï¼‰

---

## ğŸ¯ ç›®çš„

Databricks Apps ä¸Šã§ã€**Dataverse ã®ãƒ¢ãƒ‡ãƒ«é§†å‹•ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«ã€  
â€œã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å®šç¾©ã‚’æ›¸ãã ã‘ã§ CRUD UI ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹â€**  
æ±ç”¨ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚

ç‰¹å¾´ï¼š

- UI ã¯ htmx ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒãƒ¼é§†å‹•  
- çŠ¶æ…‹ç®¡ç†ã¯ Alpine.js  
- è¦‹ãŸç›®ã¯ Tailwind  
- æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ã¯ Flaskï¼ˆPythonï¼‰  
- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©ã¯ YAML ã«å®£è¨€çš„ã«è¨˜è¿°  
- ã‚«ã‚¹ã‚¿ãƒ å‡¦ç†ã‚‚å·®ã—è¾¼ã‚ã‚‹æ‹¡å¼µæ€§  

Databricks ã®ãƒ‡ãƒ¼ã‚¿åŸºç›¤ãƒ»AIãƒ»ãƒãƒƒãƒã¨è‡ªç„¶ã«çµ±åˆã§ãã‚‹ã€‚

---

# ğŸ› å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
[Databricks Apps]
   â”œâ”€ Flaskï¼ˆUI + APIï¼‰
   â”‚     â”œâ”€ htmxï¼ˆéƒ¨åˆ†æ›´æ–°ï¼‰
   â”‚     â”œâ”€ Tailwindï¼ˆUIï¼‰
   â”‚     â””â”€ Alpine.jsï¼ˆUI çŠ¶æ…‹ç®¡ç†ï¼‰
   â”œâ”€ services/ï¼ˆæ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
   â”œâ”€ repositories/ï¼ˆDB ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
   â”œâ”€ templates/ï¼ˆæ±ç”¨ UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰
   â”œâ”€ config/entities.yamlï¼ˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å®šç¾©ï¼‰
   â””â”€ Jobs / Model Servingï¼ˆãƒãƒƒãƒãƒ»AIï¼‰
```

---

# ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ¡ˆï¼‰

```
app/
  â”œâ”€ app.py
  â”œâ”€ config/
  â”‚     â””â”€ entities.yaml
  â”œâ”€ services/
  â”‚     â”œâ”€ generic_service.py
  â”‚     â””â”€ customer_service.pyï¼ˆä»»æ„ï¼‰
  â”œâ”€ repositories/
  â”‚     â”œâ”€ generic_repo.py
  â”‚     â””â”€ customer_repo.pyï¼ˆä»»æ„ï¼‰
  â”œâ”€ templates/
  â”‚     â”œâ”€ layout.html
  â”‚     â”œâ”€ components/
  â”‚     â”‚     â”œâ”€ datagrid.html
  â”‚     â”‚     â”œâ”€ form.html
  â”‚     â”‚     â”œâ”€ lookup.html
  â”‚     â”‚     â”œâ”€ modal.html
  â”‚     â”‚     â””â”€ field_types/
  â”‚     â”‚           â”œâ”€ text.html
  â”‚     â”‚           â”œâ”€ textarea.html
  â”‚     â”‚           â”œâ”€ lookup.html
  â”‚     â”‚           â””â”€ custom_xxx.html
  â”‚     â””â”€ entities/
  â”‚           â””â”€ customer/
  â”‚                 â”œâ”€ list.htmlï¼ˆä»»æ„ï¼‰
  â”‚                 â”œâ”€ form.htmlï¼ˆä»»æ„ï¼‰
  â”‚                 â””â”€ detail.htmlï¼ˆä»»æ„ï¼‰
  â””â”€ static/
        â”œâ”€ htmx.min.js
        â”œâ”€ alpine.min.js
        â””â”€ tailwind.css
```

---

# ğŸ§© YAML ã«ã‚ˆã‚‹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å®šç¾©ï¼ˆãƒ¢ãƒ‡ãƒ«é§†å‹•ã®æ ¸ï¼‰

```yaml
customer:
  table: customers
  label: é¡§å®¢

  list:
    columns:
      - { name: name, label: æ°å, width: 200 }
      - { name: email, label: ãƒ¡ãƒ¼ãƒ«, width: 300 }
      - { name: status, label: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹, width: 120 }
    default_sort: name
    page_size: 20
    actions:
      - { name: export_csv, label: CSVå‡ºåŠ›, endpoint: /customer/export }

  form:
    sections:
      - label: åŸºæœ¬æƒ…å ±
        fields:
          - { name: name, label: æ°å, type: text }
          - { name: email, label: ãƒ¡ãƒ¼ãƒ«, type: email }
      - label: è©³ç´°
        fields:
          - { name: status, label: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹, type: lookup, lookup: status }
          - { name: note, label: å‚™è€ƒ, type: textarea, rows: 4 }
    actions:
      - { name: calc_points, label: ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—, endpoint: /customer/calc_points }
```

---

# ğŸ§± æ±ç”¨ãƒ‡ãƒ¼ã‚¿ã‚°ãƒªãƒƒãƒ‰ï¼ˆcomponents/datagrid.htmlï¼‰

```html
<div id="{{ grid_id }}"
     hx-get="{{ fetch_url }}"
     hx-trigger="load"
     hx-target="#{{ grid_id }}"
     hx-swap="outerHTML">

  {% if config.list.actions %}
    <div class="flex gap-2 mb-2">
      {% for action in config.list.actions %}
        <button 
          hx-post="{{ action.endpoint }}"
          hx-include="#grid-selected"
          hx-target="#main-area"
          class="px-3 py-1 bg-gray-200">
          {{ action.label }}
        </button>
      {% endfor %}
    </div>
  {% endif %}

  <table class="table-auto w-full">
    <thead>
      <tr>
        {% for col in config.list.columns %}
          <th style="width: {{ col.width }}px">
            <a hx-get="{{ fetch_url }}?sort={{ col.name }}"
               hx-target="#{{ grid_id }}"
               hx-swap="outerHTML">
              {{ col.label }}
            </a>
          </th>
        {% endfor %}
      </tr>
    </thead>

    <tbody>
      {% for row in rows %}
        <tr class="hover:bg-gray-100 cursor-pointer"
            hx-get="/{{ entity }}/detail/{{ row.id }}"
            hx-target="#detail-area"
            hx-swap="innerHTML">
          {% for col in config.list.columns %}
            <td>{{ row[col.name] }}</td>
          {% endfor %}
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="mt-2 flex gap-2">
    {% if page > 1 %}
      <button hx-get="{{ fetch_url }}?page={{ page - 1 }}"
              hx-target="#{{ grid_id }}"
              hx-swap="outerHTML">Prev</button>
    {% endif %}
    <button hx-get="{{ fetch_url }}?page={{ page + 1 }}"
            hx-target="#{{ grid_id }}"
            hx-swap="outerHTML">Next</button>
  </div>
</div>
```

---

# ğŸ“ æ±ç”¨ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆcomponents/form.htmlï¼‰

```html
<form hx-post="{{ save_url }}" hx-target="#main-area">

  {% for section in config.form.sections %}
    <h3 class="text-lg font-bold mt-4">{{ section.label }}</h3>

    <div class="grid grid-cols-2 gap-4">
      {% for field in section.fields %}
        <div>
          <label>{{ field.label }}</label>

          {% include "components/field_types/" + field.type + ".html" %}
        </div>
      {% endfor %}
    </div>
  {% endfor %}

  {% if config.form.actions %}
    <div class="flex gap-2 mt-4">
      {% for action in config.form.actions %}
        <button 
          hx-post="{{ action.endpoint }}"
          hx-include="closest form"
          hx-target="#main-area"
          class="px-3 py-1 bg-gray-200">
          {{ action.label }}
        </button>
      {% endfor %}
    </div>
  {% endif %}

  <button type="submit" class="mt-4 px-3 py-1 bg-blue-500 text-white">ä¿å­˜</button>
</form>
```

---

# ğŸ” Lookupï¼ˆæ¤œç´¢å‹ï¼‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆcomponents/lookup.htmlï¼‰

Dataverse ã®æ¤œç´¢å‹ã¨åŒã˜ UXã€‚

```html
<div x-data="{ open: false, selectedId: row[field.name], selectedName: row[field.display] }">

  <div class="flex gap-2">
    <input type="text" x-model="selectedName" readonly class="border p-1 w-64">
    <button @click="open = true" class="px-2 py-1 bg-gray-200">æ¤œç´¢</button>
  </div>

  <input type="hidden" name="{{ field.name }}" x-model="selectedId">

  <div x-show="open" class="fixed inset-0 bg-black/50 flex items-center justify-center">
    <div class="bg-white p-4 w-96">

      <input 
        type="text"
        hx-get="/lookup/{{ field.lookup }}"
        hx-target="#lookup-results"
        hx-trigger="keyup changed delay:300ms"
        name="q"
        class="border p-1 w-full"
        placeholder="æ¤œç´¢">

      <div id="lookup-results" class="mt-2"></div>

      <button @click="open = false" class="mt-4 px-3 py-1 bg-gray-300">é–‰ã˜ã‚‹</button>
    </div>
  </div>
</div>
```

---

# ğŸ§  ã‚«ã‚¹ã‚¿ãƒ å‡¦ç†ã®å·®ã—è¾¼ã¿ãƒã‚¤ãƒ³ãƒˆï¼ˆé‡è¦ï¼‰

## 1. YAML ã«å®£è¨€

```yaml
form:
  actions:
    - { name: calc_points, label: ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—, endpoint: /customer/calc_points }
```

## 2. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§è‡ªå‹•ãƒœã‚¿ãƒ³ç”Ÿæˆ

```html
<button hx-post="{{ action.endpoint }}" hx-include="closest form">
  {{ action.label }}
</button>
```

## 3. Flaskï¼ˆservice å±¤ï¼‰ã§å®Ÿè£…

```python
@app.route("/customer/calc_points", methods=["POST"])
def calc_points():
    data = request.form
    result = customer_service.calc_points(data)
    return render_template("components/message.html", message=result)
```

---

# ğŸ”§ æ‹¡å¼µæ€§

- ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆä½æ‰€ã€ã‚¿ã‚°ã€åœ°å›³ãªã©ï¼‰  
- ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³  
- ã‚«ã‚¹ã‚¿ãƒ ä¸€è¦§åˆ—ï¼ˆè¨ˆç®—åˆ—ï¼‰  
- ã‚«ã‚¹ã‚¿ãƒ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆCSV å‡ºåŠ›ã€æ‰¿èªã€AI å‘¼ã³å‡ºã—ï¼‰  
- ãƒ¢ãƒ¼ãƒ€ãƒ«ç·¨é›†  
- ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«  
- è¡Œé¸æŠï¼‹ãƒãƒ«ã‚¯æ“ä½œ  

ã™ã¹ã¦ YAML ã¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®çµ„ã¿åˆã‚ã›ã§å®Ÿç¾å¯èƒ½ã€‚

---

# ğŸŸ¦ ã¾ã¨ã‚

ã“ã®æ§‹æƒ³ã¯ã€  
**Databricks Apps ä¸Šã§â€œPython è£½ãƒ¢ãƒ‡ãƒ«é§†å‹•ã‚¢ãƒ—ãƒªâ€ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®æœ€å°ã§æœ€å¼·ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€‚**

- UI ã¯ htmx  
- çŠ¶æ…‹ç®¡ç†ã¯ Alpine.js  
- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¯ YAML  
- æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ã¯ Flask  
- ãƒ‡ãƒ¼ã‚¿ã¯ Databricks  
- AI ã‚„ãƒãƒƒãƒã¨ã‚‚è‡ªç„¶ã«çµ±åˆ  

ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå ´æ‰€ã¯ **æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ã ã‘**ã«ãªã‚Šã€  
UI ã¯å®£è¨€çš„ã«è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ã€‚

---
