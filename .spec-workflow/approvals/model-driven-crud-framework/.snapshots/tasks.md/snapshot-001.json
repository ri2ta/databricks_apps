{
  "id": "snapshot_1766899531200_4q0gd0gtw",
  "approvalId": "approval_1766899531195_z94rlidsp",
  "approvalTitle": "model-driven-crud-framework tasks (JP)",
  "version": 1,
  "timestamp": "2025-12-28T05:25:31.200Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document\n\n- [ ] 1. エンティティローダーとスキーマ検証を実装する\n  - File: approot/services/entities_loader.py\n  - 内容: config/entities.yaml を読み込み、エンティティ定義を検証・正規化して辞書を返す。必須フィールド欠落・型不整合を検出しエラーメッセージを返す。\n  - _Leverage: config/entities.yaml, design.md の EntityConfig 定義, yaml ライブラリ_\n  - _Requirements: 要件1, 非機能(セキュリティ/信頼性)_\n  - _Prompt: Implement the task for spec model-driven-crud-framework, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Python backend developer (validation重視) | Task: YAML ローダー/バリデータを実装し、EntityConfig に正規化して返す | Restrictions: 外部 I/O は entities.yaml のみ、エラーは例外でなく検証結果として返す関数を用意 | _Leverage: config/entities.yaml, design.md | _Requirements: 要件1, 非機能(セキュリティ/信頼性) | Success: 必須キー欠落や不正型で明示的エラーを返し、有効な定義は dict で取得できる_\n\n- [ ] 2. 汎用リポジトリを実装する（list/detail/lookup）\n  - File: approot/repositories/generic_repo.py\n  - 内容: table/primary_key/columns に基づき list/detail/lookup を実行。ページング・ソートをサポートし、db.py のプールを利用。\n  - _Leverage: approot/db.py, design.md Generic Repository 節_\n  - _Requirements: 要件1, 要件2, 要件4, 非機能(パフォーマンス)_\n  - _Prompt: Implement the task for spec model-driven-crud-framework, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Python data access developer | Task: 汎用リポジトリで list/detail/lookup を実装（ページング/ソート/lookup 検索を含む） | Restrictions: 生 SQL 生成は SQL インジェクションを避ける（パラメータバインド使用）、db.py の接続ヘルパーを必ず使う | _Leverage: db.py, design.md | _Requirements: 要件1, 要件2, 要件4 | Success: list/detail/lookup が動作し、クエリパラメータに基づき正しい結果を返す_\n\n- [ ] 3. 汎用サービスを実装する（render_list/detail/form + actions ディスパッチ）\n  - File: approot/services/generic_service.py\n  - 内容: エンティティ定義とリポジトリを用い、テンプレート描画コンテキストを組み立てる。detail は mode=\"view\"、form は mode=\"create\"/\"edit\" で共通テンプレートを利用。カスタムアクションのディスパッチ枠も用意。\n  - _Leverage: entities_loader.py, generic_repo.py, design.md Generic Service 節_\n  - _Requirements: 要件1, 要件2, 要件3, 要件4_\n  - _Prompt: Implement the task for spec model-driven-crud-framework, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Python service layer developer | Task: render_list/detail/form と actions ディスパッチを実装し、テンプレートに渡すデータを組み立てる | Restrictions: mode 切替で同一テンプレートを使うこと、検証エラーや存在しないエンティティ/レコードはユーザーフレンドリーなメッセージを返す | _Leverage: entities_loader, generic_repo, design.md | _Requirements: 要件1-4 | Success: list/detail/form が正しく描画でき、未定義エンティティや欠損時に安全な応答を返す_\n\n- [ ] 4. テンプレート群を実装する（統一 entity テンプレート + コンポーネント）\n  - Files: approot/templates/components/datagrid.html; approot/templates/components/form.html; approot/templates/components/field_types/*.html; approot/templates/components/lookup.html; approot/templates/partials/entity.html; approot/templates/partials/list.html\n  - 内容: 一覧は datagrid コンポーネントでページング/ソート/行クリックを HTMX で処理。entity.html で mode(view/create/edit) を切り替え、フォームは form.html + field_types で描画。lookup モーダルも実装。\n  - _Leverage: design.md Templates 節, 既存 templates/partials/list.html/detail.html の構造, draft レポートのサンプルマークアップ_\n  - _Requirements: 要件1, 要件2, 要件3, 要件4, 非機能(ユーザビリティ/パフォーマンス)_\n  - _Prompt: Implement the task for spec model-driven-crud-framework, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flask/Jinja + HTMX UI developer | Task: datagrid/form/lookup/統一 entity テンプレートを実装し、mode で表示/編集を切替える | Restrictions: DaisyUI/Tailwind を用い、HTMX ターゲット/スワップを正しく指定、冗長な JS を追加しない | _Leverage: design.md, draft レポートの HTML サンプル | _Requirements: 要件1-4, 非機能(ユーザビリティ/パフォーマンス) | Success: 一覧/詳細/フォーム/lookup が共通テンプレートで表示され、HTMX で部分更新が機能する_\n\n- [ ] 5. Flask ルートを汎用化して配線する\n  - File: approot/app.py (既存を拡張)\n  - 内容: 汎用ルート `/<entity>/list`, `/<entity>/detail/<id>`, `/<entity>/form[/<id>]`, `/<entity>/save`, `/<entity>/actions/<action>`, `lookup/<lookup_name>` をサービス経由で呼び出す。mode を渡して単一テンプレートで描画。\n  - _Leverage: generic_service.py, design.md Flask Routes 節, 既存 app.py のルーティング_\n  - _Requirements: 要件1-4, 非機能(信頼性/セキュリティ)_\n  - _Prompt: Implement the task for spec model-driven-crud-framework, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flask developer | Task: 汎用エンドポイントを追加し、HTMX 部分テンプレートを返す | Restrictions: 既存ルートを壊さない、例外はログして簡潔なメッセージを返す、mode を適切に渡す | _Leverage: generic_service, design.md | _Requirements: 要件1-4 | Success: 各エンドポイントがサービスを呼び、共通テンプレートが適切なモードで描画される_\n\n- [ ] 6. テストを追加する（ローダー/リポジトリ/サービス/HTMX 部分）\n  - Files: tests/test_entities_loader.py; tests/test_generic_repo.py; tests/test_generic_service.py; tests/test_htmx_endpoints.py (pytest, FlaskClient)\n  - 内容: YAML 検証、list/detail/lookup クエリ組み立て、service のコンテキスト生成、HTMX レスポンスの主要要素（列・フィールド・ボタン・エラーメッセージ）を検証。\n  - _Leverage: pytest, Flask test client, design.md Testing Strategy 節_\n  - _Requirements: 要件1-4, 非機能(信頼性/パフォーマンス)\n  - _Prompt: Implement the task for spec model-driven-crud-framework, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Python QA/pytest エンジニア | Task: ローダー/リポジトリ/サービス/HTMX の単体〜軽量統合テストを追加 | Restrictions: 外部接続はモック/スタブ化、主要要素の HTML を assert、パフォーマンスは応答時間のしきい値を緩やかに検証 | _Leverage: pytest, FlaskClient, design.md | _Requirements: 要件1-4, 非機能(信頼性/パフォーマンス) | Success: 失敗するテストが先に書かれ、実装後にグリーンとなり、主要フローをカバーする_\n",
  "fileStats": {
    "size": 7540,
    "lines": 44,
    "lastModified": "2025-12-28T05:25:28.705Z"
  },
  "comments": []
}