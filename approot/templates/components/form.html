<form class="mt-4" hx-post="{{ action_url or '' }}" hx-target="{{ target or '#main-pane' }}">
  {% for section in entity.form.sections %}
  <div class="mb-6">
    <h3 class="text-lg font-semibold mb-3">{{ section.label }}</h3>
    
    {% for field in section.fields %}
      {% set value = record[field.name] if record and field.name in record else '' %}
      {% set field_error = errors[field.name] if errors and field.name in errors else None %}
      
      {% if field.type == 'text' %}
        {% include 'components/field_types/text.html' %}
      {% elif field.type == 'email' %}
        {% include 'components/field_types/email.html' %}
      {% elif field.type == 'textarea' %}
        {% include 'components/field_types/textarea.html' %}
      {% elif field.type == 'lookup' %}
        {% include 'components/field_types/lookup.html' %}
      {% else %}
        {# Fallback to text for unknown types #}
        {% include 'components/field_types/text.html' %}
      {% endif %}
    {% endfor %}
  </div>
  {% endfor %}
  
  {% if mode != 'view' %}
  <div class="flex gap-2 mt-4">
    {% for action in entity.form.actions %}
    <button type="submit" class="btn btn-primary">
      {{ action.label }}
    </button>
    {% endfor %}
  </div>
  {% endif %}
</form>
